# 浮點運算

浮點數 (floating point) 是電腦用來表示實數的方式。浮點數不是實數，只能近似實數。這產生種種問題。因此，如果你是位工作上需要處理浮點數的工程師，務必閱讀以下文件：

* David Goldberg 的 [What Every Computer Scientist Should Know About Floating-Point Arithmetic](https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html)

Forth 提供浮點運算能力，浮點運算類似整數運算，但有以下不同，

* 輸入浮點數必須有字母 `e`。字母 `e` 後的整數代表 10 的指數。若沒有整數，指數為 0。所以 `1e` 是 1.0 &times; 10<sup>0</sup> 也就是 1.0。2e3 是 2.0 &times; 10<sup>3</sup> 也就是 9.0 。
以下都是正確的浮點輸入：`1e` `1.e` `1.e0` `+1.23e-1` `-1.23e+1`。
* 四則運算指令以 `f` 開頭。比如 `f+`、`f-`、`f*`、`f/`。
* 沒有和 `mod` 及 `/mod` 對應的指令，但有求次方的指令 `f**`，其堆疊效果為 ( F: f1 f2 -- f1<sup>f2</sup>)。
* 資料堆疊放的是整數，浮點數放在另一個浮點堆疊 (floating point stack) 上。
* 浮點數的堆疊效果表示法是 ( F: before -- after )。

讓我們測試一下。

例一：輸入 `1e` `1.e` `1.e0` `+1.23e-1` `-1.23e+1` 並以 `f.` 印出來。
```
rf> 1e f.  1.e f.  1.e0 f.  +1.23e-1 f.  -1.23e+1 f.
1.0000000 1.0000000 1.0000000 0.1230000 -12.3000000  ok
```

例二：以浮點計算 7 + (6 &times; 5<sup>2</sup> + 3)
```
rf> 5e 2e f** 6e f* 3e f+ 7e f+ f.
160.0000000  ok
```

例三：以浮點計算 1/(3<sup>2</sup>)
```
rf> 1e 3e 2e f** f/  f.
0.1111111  ok
```

### 本節指令集

| 指令 | 堆疊效果           | 說明                        | 口語唸法 |
|-----|-------------------|-----------------------------|--------|
| `f.` | ( F:&nbsp; f -- ) | 印出浮點堆疊上最後的浮點數，並將它從堆疊上移除 | f-dot |
| `f+` | ( F:&nbsp; f1 f2 -- f1+f2 )| 將浮點堆疊上的 f1 加上 f2，將結果放回浮點堆疊 | f-plus |
| `f-` | ( F:&nbsp; f1 f2 -- f1-f2 )| 將浮點堆疊上的 f1 減去 f2，將結果放回浮點堆疊 | f-minus |
| `f*` | ( F:&nbsp; f1 f2 -- f1*f2 )| 將浮點堆疊上的 f1 乘以 f2，將結果放回浮點堆疊 | f-star |
| `f/` | ( F:&nbsp; f1 f2 -- f1/f2 )| 將浮點堆疊上的 f1 除以 f2，將結果放回浮點堆疊 | f-slash |
| `f**` | ( F:&nbsp; f1 f2 -- f1<sup>f2</sup>)| 求浮點堆疊上的 f1 的 f2 次方，將結果放回浮點堆疊 | f-star-star |

-----------
## 更多的浮點算術指令

| 指令 | 堆疊效果           | 說明                        | 口語唸法 |
|-----|-------------------|-----------------------------|--------|
| `fnegate` | ( F:&nbsp; f -- ) | | f-negate |
| `fabs` | ( F:&nbsp; f -- ) | | f-abs |
| `fmax` | ( F:&nbsp; f -- ) | | f-max |
| `fmin` | ( F:&nbsp; f -- ) | | f-min |
| `fsqrt` | ( F:&nbsp; f -- ) | | f-sqrt |
| `fround` | ( F:&nbsp; f -- ) | | f-round |
| `floor` | ( F:&nbsp; f -- ) | | floor |
| `fceil` | ( F:&nbsp; f -- ) | | f-ceiling |

---------------
## 三角函數 

| 指令 | 堆疊效果           | 說明                        | 口語唸法 |
|-----|-------------------|-----------------------------|--------|
| `fsin` | ( F:&nbsp; f -- ) | | f-sine |
| `fcos` | ( F:&nbsp; f -- ) | | f-cos |
| `ftan` | ( F:&nbsp; f -- ) | | f-tan |
| `fsincos` | ( F:&nbsp; f -- ) | | f-sine-cos |
| `fasin` | ( F:&nbsp; f -- ) | | f-a-sine |
| `facos` | ( F:&nbsp; f -- ) | | f-a-cos |
| `fatan` | ( F:&nbsp; f -- ) | | f-a-tan |
| `fatan2` | ( F:&nbsp; f -- ) | | f-a-tan-two |

----------------
## 整數和浮點數轉換

| 指令 | 堆疊效果           | 說明                        | 口語唸法 |
|-----|-------------------|-----------------------------|--------|
| `s>f` | ( F:&nbsp; f -- ) | | s-to-f |
| `f>s` | ( F:&nbsp; f -- ) | | f-to-s |

-------------
## 本章重點整理

* 浮點數 (floating point)

-------------------------------------
## 本章指令集
